#include <iostream>
#include <string>
#include <vector>
#include <map>
#using namespace std;

class User {
    string username;
    string password;

public:
    User() = default;
    User(const string& uname, const string& pwd) : username(uname), password(pwd) {}

    string getUsername() const { return username; }
    bool checkPassword(const string& pwd) const { return password == pwd; }
};

class Cake {
    string name;
    string description;
    double price;
    vector<string> customizations;

public:
    Cake(const string& n, const string& desc, double p, const vector<string>& customizations = {})
        : name(n), description(desc), price(p), customizations(customizations) {}

    void display() const {
        cout << "Nama       : " << name <<endl<< "   Keterangan : " << description << endl<<"   Harga      : Rp. " << price << endl;
        if (!customizations.empty()) {
            cout << "   Toping yang tersedia: ";
            for (const auto& custom : customizations) {
                cout << custom << " ";
            }
            cout << endl;
        }
    }

    string getName() const { return name; }
    double getPrice() const { return price; }
    vector<string> getCustomizations() const { return customizations; }
};

class Order {
    User customer;
    Cake cake;
    vector<string> customizations;
    double totalPrice;

public:
    Order(const User& u, const Cake& c, const vector<string>& customs, double total)
        : customer(u), cake(c), customizations(customs), totalPrice(total) {}

    void displayReceipt() const {
        cout << "Nama Pemesan : " << customer.getUsername() << endl;
        cout << "Kue          : " << cake.getName() << endl;
        if (!customizations.empty()) {
        cout << "Toping       : ";
            for (const auto& custom : customizations) {
                cout << custom << " ";
            }
            cout << endl;
        }
        cout << "Total Harga  :Rp" << totalPrice << endl;
    }
};

class BakerySystem {
    map<string, User> users;
    vector<Cake> cakes;
    vector<Order> orders;

public:
    void registerUser(const string& uname, const string& pwd) {
        if (uname.empty() || pwd.empty()) {
            cout << "Nama pengguna dan kata sandi tidak boleh kosong." << endl;
            return;
        }
        if (users.find(uname) == users.end()) {
            users[uname] = User(uname, pwd);
            cout <<"--Pendaftaran Anda Berhasil--" << endl;
        } else {
            cout << "Nama pengguna sudah ada." << endl;
        }
    }

    User* loginUser(const string& uname, const string& pwd) {
        auto it = users.find(uname);
        if (it != users.end() && it->second.checkPassword(pwd)) {
            cout << endl<<"--Login berhasil--"<<endl;
            return &it->second;
        } else {
            cout << "Nama pengguna dan kata sandi salah." << endl;
            return nullptr;
        }
    }

    void addCake(const Cake& c) {
        cakes.push_back(c);
    }

    void displayCakes() const {
        if (cakes.empty()) {
            cout << "Tidak ada kue yang tersedia." << endl;
        } else {
            for (size_t i = 0; i < cakes.size(); ++i) {
                cout << i + 1 << ". ";
                cakes[i].display();
            }
        }
    }

    void placeOrder(User* user, size_t cakeIndex, const vector<string>& customizations) {
        if (user == nullptr) {
            cout << "Pengguna tidak valid. Silahkan masuk terlebih dahulu" << endl;
            return;
        }
        if (cakeIndex < 1 || cakeIndex > cakes.size()) {
            cout << "Pemilik kue tidak valid." << endl;
            return;
        }
        const Cake& cake = cakes[cakeIndex - 1];
        double total = cake.getPrice();
        orders.emplace_back(*user, cake, customizations, total);
        cout << "Pesanan berhasil dilakukan." << endl;
    }

    void displayOrders() const {
        if (orders.empty()) {
            cout << "Belum ada pesanan ." << endl;
        } else {
            for (const auto& order : orders) {
                order.displayReceipt();
            }
        }
    }
};

void displayMainMenu() {
    cout<< "============================"<<endl;
    cout << "1. Register"<<endl;
    cout << "2. Login"<<endl;
    cout << "3. Keluar"<<endl;
    cout<< "============================"<<endl;
    cout << "Pilih Salah satu Opsi :";
   
  
    	
}

void displayUserMenu() {
	
    cout<< "============================"<<endl;
    cout << "1. Daftar Kue"<<endl;
    cout << "2. Order"<<endl;
    cout << "3. Melihat Pesanan"<<endl;
    cout << "4. Keluar"<<endl;
    cout<< "============================"<<endl;
    cout << "Pilih salah satu opsi:"<<endl;
}
